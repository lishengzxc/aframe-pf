<html>

<head>
  <script src="//cdn.bootcss.com/aframe/0.6.0/aframe-master.min.js"></script>
  <script src="//rawgit.com/donmccurdy/aframe-extras/v3.8.5/dist/aframe-extras.min.js"></script>
</head>

<body>
  <a-scene id="scene" stats>
    <a-assets>
      <a-asset-item id="knight" src="chr_knight.bake.ply"></a-asset-item>
      <a-asset-item id="old" src="chr_old.bake.ply"></a-asset-item>
      <a-asset-item id="rain" src="chr_rain.bake.ply"></a-asset-item>
      <a-asset-item id="sword" src="chr_sword.bake.ply"></a-asset-item>
      <a-asset-item id="tank" src="tank.bake.ply"></a-asset-item>
    </a-assets>

    <a-sky src="city.jpg"></a-sky>
    <a-entity ply-model="src: #knight" scale="0.1 0.1 0.1" position="-10 0 10" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    <a-entity ply-model="src: #old" scale="0.1 0.1 0.1" position="10 0 10" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    <a-entity ply-model="src: #rain" scale="0.1 0.1 0.1" position="10 0 -10" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    <a-entity ply-model="src: #sword" scale="0.1 0.1 0.1" position="-10 0 -10" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    
    <a-entity ply-model="src: #knight" scale="0.1 0.1 0.1" position="-10 0 5" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    <a-entity ply-model="src: #old" scale="0.1 0.1 0.1" position="10 0 5" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    <a-entity ply-model="src: #rain" scale="0.1 0.1 0.1" position="10 0 -5" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>
    <a-entity ply-model="src: #sword" scale="0.1 0.1 0.1" position="-10 0 -5" rotation="-90 0 0">
      <a-animation attribute="rotation" to="-90 360 0" repeat="indefinite"></a-animation>
      <a-animation direction="alternate" attribute="position" to="0 0 0" repeat="indefinite" dur="3000"></a-animation>
    </a-entity>

  </a-scene>

  <script>
    function createBox() {
      var box = document.createElement('a-box');
      var x = getRandom(30);
      var z = getRandom(30);
      box.setAttribute('position', {
        x: x,
        y: 50,
        z: z,
      });
      box.setAttribute('color', getRandomColor());
      box.setAttribute('width', 0.5);
      box.setAttribute('height', 0.5);
      box.setAttribute('depth', 0.5);
      box.setAttribute('scale', 1);

      var animation = document.createElement('a-animation');
      animation.setAttribute('attribute', 'position');
      animation.setAttribute('to', x + ' -20 ' + z);
      animation.setAttribute('dur', 5000);


      box.appendChild(animation);

      animation.addEventListener('animationend', e => {
        scene.removeChild(box);
        delete box;
      });

      scene.appendChild(box);
    }

    function getRandom(max = 1) {
      return Math.random() * max * getRandomNumberSign();
    }

    function getRandomNumberSign() {
      return Math.random() >= 0.5 ? -1 : 1;
    }

    function getRandomColor() {
      var colors = ['#FA7053', '#FDB45B', '#8BCE68', '#4BCCFD', '#969EFF', '#26DCD5', '#FF96AE', '#EFCE00', '#E196FF', '#E24848'];

      return colors[Math.random() * colors.length | 0];
    }

    setInterval(() => {
      for (var i = 0; i < 30; i++) {
        createBox();
      }
    }, 1000);
  </script>
</body>

</html>